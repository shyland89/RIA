{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/date-filter.ts"],"sourcesContent":["export const DATE_MODES = [\"closed_date\", \"pipeline_accepted_date\", \"created_at\"] as const;\nexport type DateMode = (typeof DATE_MODES)[number];\n\nexport const PERIODS = [\"7d\", \"30d\", \"90d\", \"mtd\", \"qtd\", \"custom\"] as const;\nexport type Period = (typeof PERIODS)[number];\n\nexport const DATE_MODE_LABELS: Record<DateMode, string> = {\n  closed_date: \"Closed Date\",\n  pipeline_accepted_date: \"Pipeline Accepted Date\",\n  created_at: \"Created Date\",\n};\n\nexport const PERIOD_LABELS: Record<Period, string> = {\n  \"7d\": \"Last 7 days\",\n  \"30d\": \"Last 30 days\",\n  \"90d\": \"Last 90 days\",\n  mtd: \"Month to date\",\n  qtd: \"Quarter to date\",\n  custom: \"Custom range\",\n};\n\nexport type DateFilterParams = {\n  dateMode: DateMode;\n  period: Period;\n  from?: string;\n  to?: string;\n};\n\nexport type ResolvedDateFilter = {\n  dateField: DateMode;\n  dateFrom: string;\n  dateTo: string;\n  periodLabel: string;\n};\n\nfunction startOfDay(d: Date): Date {\n  return new Date(d.getFullYear(), d.getMonth(), d.getDate());\n}\n\nfunction endOfDay(d: Date): Date {\n  return new Date(d.getFullYear(), d.getMonth(), d.getDate(), 23, 59, 59, 999);\n}\n\nfunction quarterStart(d: Date): Date {\n  const q = Math.floor(d.getMonth() / 3) * 3;\n  return new Date(d.getFullYear(), q, 1);\n}\n\nexport function resolveDateFilter(params: DateFilterParams): ResolvedDateFilter {\n  const now = new Date();\n  const dateField = DATE_MODES.includes(params.dateMode) ? params.dateMode : \"created_at\";\n  const period = PERIODS.includes(params.period) ? params.period : \"30d\";\n\n  let dateFrom: Date;\n  let dateTo: Date = endOfDay(now);\n\n  switch (period) {\n    case \"7d\":\n      dateFrom = startOfDay(new Date(now.getTime() - 7 * 86400000));\n      break;\n    case \"30d\":\n      dateFrom = startOfDay(new Date(now.getTime() - 30 * 86400000));\n      break;\n    case \"90d\":\n      dateFrom = startOfDay(new Date(now.getTime() - 90 * 86400000));\n      break;\n    case \"mtd\":\n      dateFrom = new Date(now.getFullYear(), now.getMonth(), 1);\n      break;\n    case \"qtd\":\n      dateFrom = quarterStart(now);\n      break;\n    case \"custom\":\n      dateFrom = params.from ? startOfDay(new Date(params.from)) : startOfDay(new Date(now.getTime() - 30 * 86400000));\n      dateTo = params.to ? endOfDay(new Date(params.to)) : endOfDay(now);\n      if (isNaN(dateFrom.getTime())) dateFrom = startOfDay(new Date(now.getTime() - 30 * 86400000));\n      if (isNaN(dateTo.getTime())) dateTo = endOfDay(now);\n      break;\n    default:\n      dateFrom = startOfDay(new Date(now.getTime() - 30 * 86400000));\n  }\n\n  return {\n    dateField,\n    dateFrom: dateFrom.toISOString(),\n    dateTo: dateTo.toISOString(),\n    periodLabel: period === \"custom\"\n      ? `${dateFrom.toLocaleDateString()} – ${dateTo.toLocaleDateString()}`\n      : PERIOD_LABELS[period],\n  };\n}\n\nexport function parseDateFilterFromSearchParams(params: URLSearchParams): DateFilterParams {\n  return {\n    dateMode: (params.get(\"date_mode\") as DateMode) || \"created_at\",\n    period: (params.get(\"period\") as Period) || \"30d\",\n    from: params.get(\"from\") || undefined,\n    to: params.get(\"to\") || undefined,\n  };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAO,MAAM,aAAa;IAAC;IAAe;IAA0B;CAAa;AAG1E,MAAM,UAAU;IAAC;IAAM;IAAO;IAAO;IAAO;IAAO;CAAS;AAG5D,MAAM,mBAA6C;IACxD,aAAa;IACb,wBAAwB;IACxB,YAAY;AACd;AAEO,MAAM,gBAAwC;IACnD,MAAM;IACN,OAAO;IACP,OAAO;IACP,KAAK;IACL,KAAK;IACL,QAAQ;AACV;AAgBA,SAAS,WAAW,CAAO;IACzB,OAAO,IAAI,KAAK,EAAE,WAAW,IAAI,EAAE,QAAQ,IAAI,EAAE,OAAO;AAC1D;AAEA,SAAS,SAAS,CAAO;IACvB,OAAO,IAAI,KAAK,EAAE,WAAW,IAAI,EAAE,QAAQ,IAAI,EAAE,OAAO,IAAI,IAAI,IAAI,IAAI;AAC1E;AAEA,SAAS,aAAa,CAAO;IAC3B,MAAM,IAAI,KAAK,KAAK,CAAC,EAAE,QAAQ,KAAK,KAAK;IACzC,OAAO,IAAI,KAAK,EAAE,WAAW,IAAI,GAAG;AACtC;AAEO,SAAS,kBAAkB,MAAwB;IACxD,MAAM,MAAM,IAAI;IAChB,MAAM,YAAY,WAAW,QAAQ,CAAC,OAAO,QAAQ,IAAI,OAAO,QAAQ,GAAG;IAC3E,MAAM,SAAS,QAAQ,QAAQ,CAAC,OAAO,MAAM,IAAI,OAAO,MAAM,GAAG;IAEjE,IAAI;IACJ,IAAI,SAAe,SAAS;IAE5B,OAAQ;QACN,KAAK;YACH,WAAW,WAAW,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI;YACnD;QACF,KAAK;YACH,WAAW,WAAW,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK;YACpD;QACF,KAAK;YACH,WAAW,WAAW,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK;YACpD;QACF,KAAK;YACH,WAAW,IAAI,KAAK,IAAI,WAAW,IAAI,IAAI,QAAQ,IAAI;YACvD;QACF,KAAK;YACH,WAAW,aAAa;YACxB;QACF,KAAK;YACH,WAAW,OAAO,IAAI,GAAG,WAAW,IAAI,KAAK,OAAO,IAAI,KAAK,WAAW,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK;YACtG,SAAS,OAAO,EAAE,GAAG,SAAS,IAAI,KAAK,OAAO,EAAE,KAAK,SAAS;YAC9D,IAAI,MAAM,SAAS,OAAO,KAAK,WAAW,WAAW,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK;YACnF,IAAI,MAAM,OAAO,OAAO,KAAK,SAAS,SAAS;YAC/C;QACF;YACE,WAAW,WAAW,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK;IACxD;IAEA,OAAO;QACL;QACA,UAAU,SAAS,WAAW;QAC9B,QAAQ,OAAO,WAAW;QAC1B,aAAa,WAAW,WACpB,GAAG,SAAS,kBAAkB,GAAG,GAAG,EAAE,OAAO,kBAAkB,IAAI,GACnE,aAAa,CAAC,OAAO;IAC3B;AACF;AAEO,SAAS,gCAAgC,MAAuB;IACrE,OAAO;QACL,UAAU,AAAC,OAAO,GAAG,CAAC,gBAA6B;QACnD,QAAQ,AAAC,OAAO,GAAG,CAAC,aAAwB;QAC5C,MAAM,OAAO,GAAG,CAAC,WAAW;QAC5B,IAAI,OAAO,GAAG,CAAC,SAAS;IAC1B;AACF"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\n\nexport async function createClient() {\n  const cookieStore = await cookies();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            );\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing user sessions.\n          }\n        },\n      },\n    }\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,uEAAuE;gBACzE;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/get-user-org.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\";\nimport { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\n\nexport type UserOrg = {\n  user: { id: string; email: string };\n  membership: { org_id: string; role: string };\n  org: { id: string; name: string };\n};\n\nexport type UserOrgError = {\n  error: string;\n  status: number;\n};\n\nfunction createAdminClient() {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\n  );\n}\n\nexport async function getUserOrg(): Promise<UserOrg | UserOrgError> {\n  const supabase = await createClient();\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    return { error: \"Unauthorized\", status: 401 };\n  }\n\n  const admin = createAdminClient();\n\n  const { data: membership, error: memError } = await admin\n    .from(\"memberships\")\n    .select(\"org_id, role\")\n    .eq(\"user_id\", user.id)\n    .limit(1)\n    .maybeSingle();\n\n  if (memError || !membership) {\n    return {\n      error: \"No membership found. You may need to create an organization or contact support.\",\n      status: 403,\n    };\n  }\n\n  const { data: org, error: orgError } = await admin\n    .from(\"organizations\")\n    .select(\"id, name\")\n    .eq(\"id\", membership.org_id)\n    .limit(1)\n    .maybeSingle();\n\n  if (orgError || !org) {\n    return {\n      error: \"Organization record not found. Please contact support.\",\n      status: 500,\n    };\n  }\n\n  return {\n    user: { id: user.id, email: user.email ?? \"\" },\n    membership: { org_id: membership.org_id, role: membership.role },\n    org: { id: org.id, name: org.name },\n  };\n}\n\nexport function isUserOrgError(result: UserOrg | UserOrgError): result is UserOrgError {\n  return \"error\" in result;\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAaA,SAAS;IACP,OAAO,IAAA,8LAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB;AAEzC;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,OAAO;YAAgB,QAAQ;QAAI;IAC9C;IAEA,MAAM,QAAQ;IAEd,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,MACjD,IAAI,CAAC,eACL,MAAM,CAAC,gBACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,KAAK,CAAC,GACN,WAAW;IAEd,IAAI,YAAY,CAAC,YAAY;QAC3B,OAAO;YACL,OAAO;YACP,QAAQ;QACV;IACF;IAEA,MAAM,EAAE,MAAM,GAAG,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,MAC1C,IAAI,CAAC,iBACL,MAAM,CAAC,YACP,EAAE,CAAC,MAAM,WAAW,MAAM,EAC1B,KAAK,CAAC,GACN,WAAW;IAEd,IAAI,YAAY,CAAC,KAAK;QACpB,OAAO;YACL,OAAO;YACP,QAAQ;QACV;IACF;IAEA,OAAO;QACL,MAAM;YAAE,IAAI,KAAK,EAAE;YAAE,OAAO,KAAK,KAAK,IAAI;QAAG;QAC7C,YAAY;YAAE,QAAQ,WAAW,MAAM;YAAE,MAAM,WAAW,IAAI;QAAC;QAC/D,KAAK;YAAE,IAAI,IAAI,EAAE;YAAE,MAAM,IAAI,IAAI;QAAC;IACpC;AACF;AAEO,SAAS,eAAe,MAA8B;IAC3D,OAAO,WAAW;AACpB"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/enrichment.ts"],"sourcesContent":["import OpenAI from \"openai\";\n\n// ─── Industry Cluster Taxonomy (NACE-backed, sales-readable labels) ───────────\n\nexport const INDUSTRY_CLUSTERS = [\n  \"Technology & Software\",\n  \"Financial Services\",\n  \"Professional Services\",\n  \"Healthcare & Life Sciences\",\n  \"Retail & E-commerce\",\n  \"Manufacturing & Industrial\",\n  \"Media & Advertising\",\n  \"Logistics & Transport\",\n  \"Construction & Real Estate\",\n  \"Hospitality & Travel\",\n  \"Public Sector & Education\",\n  \"Telecommunications\",\n  \"Energy & Utilities\",\n  \"Other\",\n] as const;\n\nexport type IndustryCluster = (typeof INDUSTRY_CLUSTERS)[number];\n\n// ─── Source Group Taxonomy ────────────────────────────────────────────────────\n\nexport const SOURCE_GROUPS = [\"inbound\", \"outbound\", \"other\"] as const;\nexport type SourceGroup = (typeof SOURCE_GROUPS)[number];\n\nexport const SOURCE_GROUP_LABELS: Record<SourceGroup, string> = {\n  inbound: \"Inbound\",\n  outbound: \"Outbound\",\n  other: \"Other\",\n};\n\n// Deterministic fallback rules — used if LLM classification fails\n// or as a pre-filter to avoid unnecessary API calls\n\nconst INBOUND_KEYWORDS = [\n  \"website\", \"web\", \"organic\", \"seo\", \"content\", \"blog\", \"social\",\n  \"paid search\", \"ppc\", \"adwords\", \"google ads\", \"paid\", \"referral\",\n  \"word of mouth\", \"wom\", \"review\", \"g2\", \"capterra\", \"inbound\",\n  \"marketing\", \"newsletter\", \"webinar\", \"conference inbound\",\n];\n\nconst OUTBOUND_KEYWORDS = [\n  \"outbound\", \"cold\", \"sdr\", \"bdr\", \"ae\", \"prospecting\", \"sequence\",\n  \"cadence\", \"linkedin\", \"email outreach\", \"cold email\", \"cold call\",\n  \"phone\", \"direct\", \"sales rep\", \"sales development\",\n];\n\nexport function inferSourceGroupDeterministic(rawSource: string): SourceGroup | null {\n  const lower = rawSource.toLowerCase().trim();\n  if (INBOUND_KEYWORDS.some((k) => lower.includes(k))) return \"inbound\";\n  if (OUTBOUND_KEYWORDS.some((k) => lower.includes(k))) return \"outbound\";\n  return null;\n}\n\n// ─── Enrichment Result Types ──────────────────────────────────────────────────\n\nexport type IndustryMapping = Record<string, IndustryCluster>; // raw → cluster\nexport type SourceMapping = Record<string, SourceGroup>;       // raw → group\n\nexport type EnrichmentMapping = {\n  industry: IndustryMapping;\n  source: SourceMapping;\n};\n\n// ─── LLM Classification ───────────────────────────────────────────────────────\n\n/**\n * Classify unique raw industry and source values into clusters.\n * Returns deterministic fallback for source values it can resolve without LLM.\n * Runs a single batched LLM call for everything else.\n */\nexport async function classifyEnrichmentValues(\n  uniqueIndustries: string[],\n  uniqueSources: string[],\n  apiKey: string\n): Promise<EnrichmentMapping> {\n  // Pre-resolve sources deterministically\n  const sourceMapping: SourceMapping = {};\n  const sourcesNeedingLLM: string[] = [];\n\n  for (const s of uniqueSources) {\n    const det = inferSourceGroupDeterministic(s);\n    if (det) {\n      sourceMapping[s] = det;\n    } else {\n      sourcesNeedingLLM.push(s);\n    }\n  }\n\n  // If nothing needs LLM classification, return early\n  if (uniqueIndustries.length === 0 && sourcesNeedingLLM.length === 0) {\n    return { industry: {}, source: sourceMapping };\n  }\n\n  const openai = new OpenAI({ apiKey });\n\n  const industrySection =\n    uniqueIndustries.length > 0\n      ? `INDUSTRIES TO CLASSIFY (map each to one of the clusters listed):\n${uniqueIndustries.map((i, idx) => `${idx + 1}. \"${i}\"`).join(\"\\n\")}\n\nAvailable industry clusters:\n${INDUSTRY_CLUSTERS.map((c) => `- \"${c}\"`).join(\"\\n\")}`\n      : \"\";\n\n  const sourceSection =\n    sourcesNeedingLLM.length > 0\n      ? `SOURCES TO CLASSIFY (map each to \"inbound\", \"outbound\", or \"other\"):\n${sourcesNeedingLLM.map((s, idx) => `${idx + 1}. \"${s}\"`).join(\"\\n\")}\n\nRules:\n- \"inbound\": lead came to you (website, paid search, referral, event where prospect approached, partner-sourced)\n- \"outbound\": you went to them (cold outreach, SDR sequences, cold call, LinkedIn prospecting)\n- \"other\": genuinely ambiguous or neither (e.g. \"existing customer\", \"unknown\")`\n      : \"\";\n\n  const systemPrompt = `You are a data classification assistant for a B2B sales analytics platform. \nYou receive raw values from CRM exports and map them to standardized groups.\nRespond ONLY with a valid JSON object — no explanation, no markdown.`;\n\n  const userPrompt = `Classify the following values and return a JSON object with this exact structure:\n{\n  \"industry\": { \"<raw_value>\": \"<cluster_label>\", ... },\n  \"source\": { \"<raw_value>\": \"<inbound|outbound|other>\", ... }\n}\n\n${industrySection}\n\n${sourceSection}\n\nImportant:\n- Every input value must appear as a key in the output\n- Use EXACT cluster labels from the list provided — no variations\n- If an industry is genuinely ambiguous, use \"Other\"\n- Return empty objects {} for sections with no inputs`;\n\n  try {\n    const response = await openai.responses.create({\n      model: \"gpt-5.2\",\n      input: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userPrompt },\n      ],\n      text: {\n        format: { type: \"json_object\" },\n      },\n    });\n\n    const parsed = JSON.parse(response.output_text);\n\n    const industryMapping: IndustryMapping = {};\n    if (parsed.industry && typeof parsed.industry === \"object\") {\n      for (const [raw, cluster] of Object.entries(parsed.industry)) {\n        if (INDUSTRY_CLUSTERS.includes(cluster as IndustryCluster)) {\n          industryMapping[raw] = cluster as IndustryCluster;\n        } else {\n          // LLM returned an invalid cluster — fall back to Other\n          industryMapping[raw] = \"Other\";\n        }\n      }\n    }\n\n    // Merge LLM source results with deterministic ones\n    if (parsed.source && typeof parsed.source === \"object\") {\n      for (const [raw, group] of Object.entries(parsed.source)) {\n        if (SOURCE_GROUPS.includes(group as SourceGroup)) {\n          sourceMapping[raw] = group as SourceGroup;\n        } else {\n          sourceMapping[raw] = \"other\";\n        }\n      }\n    }\n\n    // Fill in any industries not returned by LLM\n    for (const industry of uniqueIndustries) {\n      if (!industryMapping[industry]) {\n        industryMapping[industry] = \"Other\";\n      }\n    }\n\n    return { industry: industryMapping, source: sourceMapping };\n  } catch (err) {\n    console.error(\"Enrichment classification failed:\", err);\n\n    // Full fallback — return Other for all industries, other for unresolved sources\n    const industryFallback: IndustryMapping = {};\n    for (const i of uniqueIndustries) industryFallback[i] = \"Other\";\n\n    for (const s of sourcesNeedingLLM) sourceMapping[s] = \"other\";\n\n    return { industry: industryFallback, source: sourceMapping };\n  }\n}\n\n/**\n * Apply enrichment mapping to a row's raw field values.\n * Returns null if the raw value isn't in the mapping (e.g. field was null).\n */\nexport function applyIndustryCluster(\n  rawIndustry: string | null | undefined,\n  mapping: IndustryMapping\n): string | null {\n  if (!rawIndustry) return null;\n  return mapping[rawIndustry] ?? null;\n}\n\nexport function applySourceGroup(\n  rawSource: string | null | undefined,\n  mapping: SourceMapping\n): SourceGroup | null {\n  if (!rawSource) return null;\n  return mapping[rawSource] ?? null;\n}\n\n/**\n * Extract unique non-null values for a given field from parsed CSV records.\n */\nexport function extractUniqueValues(\n  records: Record<string, string>[],\n  columnName: string | undefined\n): string[] {\n  if (!columnName) return [];\n  const seen = new Set<string>();\n  for (const row of records) {\n    const val = row[columnName]?.trim();\n    if (val && val !== \"\" && ![\"na\", \"n/a\", \"null\", \"none\", \"-\"].includes(val.toLowerCase())) {\n      seen.add(val);\n    }\n  }\n  return Array.from(seen);\n}"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;;AAIO,MAAM,oBAAoB;IAC/B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAMM,MAAM,gBAAgB;IAAC;IAAW;IAAY;CAAQ;AAGtD,MAAM,sBAAmD;IAC9D,SAAS;IACT,UAAU;IACV,OAAO;AACT;AAEA,kEAAkE;AAClE,oDAAoD;AAEpD,MAAM,mBAAmB;IACvB;IAAW;IAAO;IAAW;IAAO;IAAW;IAAQ;IACvD;IAAe;IAAO;IAAW;IAAc;IAAQ;IACvD;IAAiB;IAAO;IAAU;IAAM;IAAY;IACpD;IAAa;IAAc;IAAW;CACvC;AAED,MAAM,oBAAoB;IACxB;IAAY;IAAQ;IAAO;IAAO;IAAM;IAAe;IACvD;IAAW;IAAY;IAAkB;IAAc;IACvD;IAAS;IAAU;IAAa;CACjC;AAEM,SAAS,8BAA8B,SAAiB;IAC7D,MAAM,QAAQ,UAAU,WAAW,GAAG,IAAI;IAC1C,IAAI,iBAAiB,IAAI,CAAC,CAAC,IAAM,MAAM,QAAQ,CAAC,KAAK,OAAO;IAC5D,IAAI,kBAAkB,IAAI,CAAC,CAAC,IAAM,MAAM,QAAQ,CAAC,KAAK,OAAO;IAC7D,OAAO;AACT;AAmBO,eAAe,yBACpB,gBAA0B,EAC1B,aAAuB,EACvB,MAAc;IAEd,wCAAwC;IACxC,MAAM,gBAA+B,CAAC;IACtC,MAAM,oBAA8B,EAAE;IAEtC,KAAK,MAAM,KAAK,cAAe;QAC7B,MAAM,MAAM,8BAA8B;QAC1C,IAAI,KAAK;YACP,aAAa,CAAC,EAAE,GAAG;QACrB,OAAO;YACL,kBAAkB,IAAI,CAAC;QACzB;IACF;IAEA,oDAAoD;IACpD,IAAI,iBAAiB,MAAM,KAAK,KAAK,kBAAkB,MAAM,KAAK,GAAG;QACnE,OAAO;YAAE,UAAU,CAAC;YAAG,QAAQ;QAAc;IAC/C;IAEA,MAAM,SAAS,IAAI,iLAAM,CAAC;QAAE;IAAO;IAEnC,MAAM,kBACJ,iBAAiB,MAAM,GAAG,IACtB,CAAC;AACT,EAAE,iBAAiB,GAAG,CAAC,CAAC,GAAG,MAAQ,GAAG,MAAM,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM;;;AAGpE,EAAE,kBAAkB,GAAG,CAAC,CAAC,IAAM,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,GAC/C;IAEN,MAAM,gBACJ,kBAAkB,MAAM,GAAG,IACvB,CAAC;AACT,EAAE,kBAAkB,GAAG,CAAC,CAAC,GAAG,MAAQ,GAAG,MAAM,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM;;;;;+EAKU,CAAC,GACxE;IAEN,MAAM,eAAe,CAAC;;oEAE4C,CAAC;IAEnE,MAAM,aAAa,CAAC;;;;;;AAMtB,EAAE,gBAAgB;;AAElB,EAAE,cAAc;;;;;;qDAMqC,CAAC;IAEpD,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,SAAS,CAAC,MAAM,CAAC;YAC7C,OAAO;YACP,OAAO;gBACL;oBAAE,MAAM;oBAAU,SAAS;gBAAa;gBACxC;oBAAE,MAAM;oBAAQ,SAAS;gBAAW;aACrC;YACD,MAAM;gBACJ,QAAQ;oBAAE,MAAM;gBAAc;YAChC;QACF;QAEA,MAAM,SAAS,KAAK,KAAK,CAAC,SAAS,WAAW;QAE9C,MAAM,kBAAmC,CAAC;QAC1C,IAAI,OAAO,QAAQ,IAAI,OAAO,OAAO,QAAQ,KAAK,UAAU;YAC1D,KAAK,MAAM,CAAC,KAAK,QAAQ,IAAI,OAAO,OAAO,CAAC,OAAO,QAAQ,EAAG;gBAC5D,IAAI,kBAAkB,QAAQ,CAAC,UAA6B;oBAC1D,eAAe,CAAC,IAAI,GAAG;gBACzB,OAAO;oBACL,uDAAuD;oBACvD,eAAe,CAAC,IAAI,GAAG;gBACzB;YACF;QACF;QAEA,mDAAmD;QACnD,IAAI,OAAO,MAAM,IAAI,OAAO,OAAO,MAAM,KAAK,UAAU;YACtD,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,OAAO,OAAO,CAAC,OAAO,MAAM,EAAG;gBACxD,IAAI,cAAc,QAAQ,CAAC,QAAuB;oBAChD,aAAa,CAAC,IAAI,GAAG;gBACvB,OAAO;oBACL,aAAa,CAAC,IAAI,GAAG;gBACvB;YACF;QACF;QAEA,6CAA6C;QAC7C,KAAK,MAAM,YAAY,iBAAkB;YACvC,IAAI,CAAC,eAAe,CAAC,SAAS,EAAE;gBAC9B,eAAe,CAAC,SAAS,GAAG;YAC9B;QACF;QAEA,OAAO;YAAE,UAAU;YAAiB,QAAQ;QAAc;IAC5D,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,qCAAqC;QAEnD,gFAAgF;QAChF,MAAM,mBAAoC,CAAC;QAC3C,KAAK,MAAM,KAAK,iBAAkB,gBAAgB,CAAC,EAAE,GAAG;QAExD,KAAK,MAAM,KAAK,kBAAmB,aAAa,CAAC,EAAE,GAAG;QAEtD,OAAO;YAAE,UAAU;YAAkB,QAAQ;QAAc;IAC7D;AACF;AAMO,SAAS,qBACd,WAAsC,EACtC,OAAwB;IAExB,IAAI,CAAC,aAAa,OAAO;IACzB,OAAO,OAAO,CAAC,YAAY,IAAI;AACjC;AAEO,SAAS,iBACd,SAAoC,EACpC,OAAsB;IAEtB,IAAI,CAAC,WAAW,OAAO;IACvB,OAAO,OAAO,CAAC,UAAU,IAAI;AAC/B;AAKO,SAAS,oBACd,OAAiC,EACjC,UAA8B;IAE9B,IAAI,CAAC,YAAY,OAAO,EAAE;IAC1B,MAAM,OAAO,IAAI;IACjB,KAAK,MAAM,OAAO,QAAS;QACzB,MAAM,MAAM,GAAG,CAAC,WAAW,EAAE;QAC7B,IAAI,OAAO,QAAQ,MAAM,CAAC;YAAC;YAAM;YAAO;YAAQ;YAAQ;SAAI,CAAC,QAAQ,CAAC,IAAI,WAAW,KAAK;YACxF,KAAK,GAAG,CAAC;QACX;IACF;IACA,OAAO,MAAM,IAAI,CAAC;AACpB"}},
    {"offset": {"line": 442, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/dimension-filter.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\";\nimport { getUserOrg, isUserOrgError } from \"@/lib/get-user-org\";\nimport { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\nimport { NextResponse } from \"next/server\";\nimport { parse } from \"csv-parse/sync\";\nimport {\n  classifyEnrichmentValues,\n  extractUniqueValues,\n  applyIndustryCluster,\n  applySourceGroup,\n  type EnrichmentMapping,\n} from \"@/lib/enrichment\";\n\nconst REQUIRED_FIELDS = [\"name\", \"amount\", \"outcome\"] as const;\nconst OPTIONAL_DIMENSION_FIELDS = [\"role\", \"industry\", \"source\", \"segment\", \"country\"] as const;\nconst DATE_FIELDS = [\"created_at\", \"closed_date\", \"pipeline_accepted_date\"] as const;\nconst VALID_OUTCOMES = [\"open\", \"won\", \"lost\"];\nconst NULL_TOKENS = [\"\", \"na\", \"n/a\", \"null\", \"none\", \"-\"];\n\nfunction isNullish(val: string | undefined): boolean {\n  if (!val) return true;\n  return NULL_TOKENS.includes(val.trim().toLowerCase());\n}\n\nfunction normalizeDimension(val: string | undefined): string | null {\n  if (!val) return null;\n  const trimmed = val.trim();\n  if (NULL_TOKENS.includes(trimmed.toLowerCase())) return null;\n  return trimmed;\n}\n\nfunction createAdminClient() {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\n  );\n}\n\nexport async function POST(request: Request) {\n  const result = await getUserOrg();\n\n  if (isUserOrgError(result)) {\n    return NextResponse.json({ error: result.error }, { status: result.status });\n  }\n\n  const supabase = await createClient();\n  const admin = createAdminClient();\n  const user = result.user;\n  const orgId = result.membership.org_id;\n\n  const formData = await request.formData();\n  const file = formData.get(\"file\") as File | null;\n  const mappingJson = formData.get(\"mapping\") as string | null;\n  const enrichmentMappingJson = formData.get(\"enrichment_mapping\") as string | null;\n  const importMode = (formData.get(\"mode\") as string) || \"append\";\n\n  if (!file || !mappingJson) {\n    return NextResponse.json(\n      { error: \"File and column mapping are required\" },\n      { status: 400 }\n    );\n  }\n\n  let mapping: Record<string, string>;\n  try {\n    mapping = JSON.parse(mappingJson);\n  } catch {\n    return NextResponse.json({ error: \"Invalid mapping format\" }, { status: 400 });\n  }\n\n  // Parse user-reviewed enrichment mapping if provided\n  let userEnrichmentMapping: EnrichmentMapping | null = null;\n  if (enrichmentMappingJson) {\n    try {\n      userEnrichmentMapping = JSON.parse(enrichmentMappingJson);\n    } catch {\n      // Not fatal — will re-classify\n    }\n  }\n\n  for (const field of REQUIRED_FIELDS) {\n    if (!mapping[field]) {\n      return NextResponse.json(\n        { error: `Missing mapping for required field: ${field}` },\n        { status: 400 }\n      );\n    }\n  }\n\n  const hasAtLeastOneDate = DATE_FIELDS.some((df) => !!mapping[df]);\n  if (!hasAtLeastOneDate) {\n    return NextResponse.json(\n      { error: \"At least one date field must be mapped (created_at, closed_date, or pipeline_accepted_date)\" },\n      { status: 400 }\n    );\n  }\n\n  const text = await file.text();\n  let records: Record<string, string>[];\n  try {\n    records = parse(text, {\n      columns: true,\n      skip_empty_lines: true,\n      trim: true,\n      bom: true,\n    });\n  } catch (e: any) {\n    return NextResponse.json({ error: `CSV parse error: ${e.message}` }, { status: 400 });\n  }\n\n  // ─── Enrichment Classification ─────────────────────────────────────────────\n  // Use the user-reviewed mapping if provided; otherwise classify fresh.\n  let enrichmentMapping: EnrichmentMapping = { industry: {}, source: {} };\n\n  const apiKey = process.env.OPENAI_API_KEY;\n\n  if (userEnrichmentMapping) {\n    enrichmentMapping = userEnrichmentMapping;\n  } else if (apiKey) {\n    const uniqueIndustries = extractUniqueValues(records, mapping.industry);\n    const uniqueSources = extractUniqueValues(records, mapping.source);\n\n    if (uniqueIndustries.length > 0 || uniqueSources.length > 0) {\n      try {\n        enrichmentMapping = await classifyEnrichmentValues(\n          uniqueIndustries,\n          uniqueSources,\n          apiKey\n        );\n      } catch (err) {\n        console.error(\"Enrichment classification error (non-fatal):\", err);\n        // Continue without enrichment — enrichment fields will be null\n      }\n    }\n  }\n  // ──────────────────────────────────────────────────────────────────────────\n\n  const { data: job, error: jobError } = await admin\n    .from(\"import_jobs\")\n    .insert({\n      org_id: orgId,\n      user_id: user.id,\n      filename: file.name,\n      inserted_count: 0,\n      error_count: 0,\n      skipped_count: 0,\n      row_count: records.length,\n      status: \"running\",\n      is_active: true,\n      import_mode: importMode === \"replace\" ? \"replace\" : \"append\",\n      mapping_config: mapping,\n      enrichment_mapping: enrichmentMapping,\n      started_at: new Date().toISOString(),\n    })\n    .select(\"id\")\n    .single();\n\n  if (jobError || !job) {\n    return NextResponse.json(\n      { error: `Failed to create import job: ${jobError?.message}` },\n      { status: 500 }\n    );\n  }\n\n  const jobId = job.id;\n\n  if (importMode === \"replace\") {\n    await admin\n      .from(\"import_jobs\")\n      .update({ is_active: false })\n      .eq(\"org_id\", orgId)\n      .neq(\"id\", jobId);\n\n    const { error: deleteError } = await admin\n      .from(\"opportunities\")\n      .delete()\n      .eq(\"org_id\", orgId)\n      .is(\"import_job_id\", null);\n\n    if (deleteError) {\n      console.error(\"Failed to delete unlinked opportunities:\", deleteError.message);\n    }\n\n    const { data: priorJobs } = await admin\n      .from(\"import_jobs\")\n      .select(\"id\")\n      .eq(\"org_id\", orgId)\n      .eq(\"is_active\", false);\n\n    if (priorJobs && priorJobs.length > 0) {\n      for (const pj of priorJobs) {\n        await admin\n          .from(\"opportunities\")\n          .delete()\n          .eq(\"org_id\", orgId)\n          .eq(\"import_job_id\", pj.id);\n      }\n    }\n  }\n\n  let insertedCount = 0;\n  let skippedCount = 0;\n  const errors: { row_number: number; error_message: string; raw_row_json: any }[] = [];\n\n  for (let i = 0; i < records.length; i++) {\n    const row = records[i];\n    const rowNum = i + 2;\n    const rowErrors: string[] = [];\n\n    const name = row[mapping.name]?.trim() || \"\";\n    const amountStr = row[mapping.amount]?.trim() || \"\";\n    const outcome = row[mapping.outcome]?.trim()?.toLowerCase() || \"\";\n    const roleStr = mapping.role ? row[mapping.role]?.trim() : undefined;\n    const industryStr = mapping.industry ? row[mapping.industry]?.trim() : undefined;\n    const sourceStr = mapping.source ? row[mapping.source]?.trim() : undefined;\n    const createdAtStr = mapping.created_at ? row[mapping.created_at]?.trim() : undefined;\n    const closedDateStr = mapping.closed_date ? row[mapping.closed_date]?.trim() : undefined;\n    const pipelineDateStr = mapping.pipeline_accepted_date ? row[mapping.pipeline_accepted_date]?.trim() : undefined;\n    const segmentStr = mapping.segment ? row[mapping.segment]?.trim() : undefined;\n    const countryStr = mapping.country ? row[mapping.country]?.trim() : undefined;\n\n    if (!name) rowErrors.push(\"name is required\");\n\n    const amount = parseFloat(amountStr);\n    if (!amountStr || isNaN(amount)) {\n      rowErrors.push(\"amount must be a valid number\");\n    }\n\n    if (!VALID_OUTCOMES.includes(outcome)) {\n      rowErrors.push(`outcome must be one of: ${VALID_OUTCOMES.join(\", \")} (got \"${outcome}\")`);\n    }\n\n    let createdAt: string | undefined;\n    if (createdAtStr && !isNullish(createdAtStr)) {\n      const d = new Date(createdAtStr);\n      if (isNaN(d.getTime())) {\n        rowErrors.push(\"created_at is not a valid date\");\n      } else {\n        createdAt = d.toISOString();\n      }\n    }\n\n    let closedDate: string | undefined;\n    if (closedDateStr && !isNullish(closedDateStr)) {\n      const d = new Date(closedDateStr);\n      if (isNaN(d.getTime())) {\n        rowErrors.push(\"closed_date is not a valid date\");\n      } else {\n        closedDate = d.toISOString();\n      }\n    }\n\n    let pipelineAcceptedDate: string | undefined;\n    if (pipelineDateStr && !isNullish(pipelineDateStr)) {\n      const d = new Date(pipelineDateStr);\n      if (isNaN(d.getTime())) {\n        rowErrors.push(\"pipeline_accepted_date is not a valid date\");\n      } else {\n        pipelineAcceptedDate = d.toISOString();\n      }\n    }\n\n    if (rowErrors.length > 0) {\n      errors.push({\n        row_number: rowNum,\n        error_message: rowErrors.join(\"; \"),\n        raw_row_json: row,\n      });\n      continue;\n    }\n\n    const normalizedIndustry = normalizeDimension(industryStr);\n    const normalizedSource = normalizeDimension(sourceStr);\n\n    const insertData: any = {\n      org_id: orgId,\n      import_job_id: jobId,\n      name: name || null,\n      role: normalizeDimension(roleStr),\n      industry: normalizedIndustry,\n      source: normalizedSource,\n      amount,\n      outcome,\n      segment: normalizeDimension(segmentStr),\n      country: normalizeDimension(countryStr),\n      // Enriched fields\n      industry_cluster: applyIndustryCluster(normalizedIndustry, enrichmentMapping.industry),\n      source_group: applySourceGroup(normalizedSource, enrichmentMapping.source),\n    };\n\n    if (createdAt) insertData.created_at = createdAt;\n    if (closedDate) insertData.closed_date = closedDate;\n    if (pipelineAcceptedDate) insertData.pipeline_accepted_date = pipelineAcceptedDate;\n\n    const { error: insertError } = await admin\n      .from(\"opportunities\")\n      .insert(insertData);\n\n    if (insertError) {\n      errors.push({\n        row_number: rowNum,\n        error_message: insertError.message,\n        raw_row_json: row,\n      });\n    } else {\n      insertedCount++;\n    }\n  }\n\n  if (errors.length > 0) {\n    const errorInserts = errors.map((e) => ({\n      job_id: jobId,\n      row_number: e.row_number,\n      error_message: e.error_message,\n      raw_row_json: e.raw_row_json,\n    }));\n    await admin.from(\"import_errors\").insert(errorInserts);\n  }\n\n  const finalStatus = insertedCount > 0 ? \"completed\" : errors.length > 0 ? \"failed\" : \"completed\";\n\n  await admin\n    .from(\"import_jobs\")\n    .update({\n      inserted_count: insertedCount,\n      error_count: errors.length,\n      skipped_count: skippedCount,\n      status: finalStatus,\n      completed_at: new Date().toISOString(),\n    })\n    .eq(\"id\", jobId);\n\n  return NextResponse.json({\n    jobId,\n    insertedCount,\n    errorCount: errors.length,\n    skippedCount,\n    totalRows: records.length,\n    errors: errors.slice(0, 50),\n    enrichmentMapping, // returned so UI can display what was applied\n  });\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAQA,MAAM,kBAAkB;IAAC;IAAQ;IAAU;CAAU;AACrD,MAAM,4BAA4B;IAAC;IAAQ;IAAY;IAAU;IAAW;CAAU;AACtF,MAAM,cAAc;IAAC;IAAc;IAAe;CAAyB;AAC3E,MAAM,iBAAiB;IAAC;IAAQ;IAAO;CAAO;AAC9C,MAAM,cAAc;IAAC;IAAI;IAAM;IAAO;IAAQ;IAAQ;CAAI;AAE1D,SAAS,UAAU,GAAuB;IACxC,IAAI,CAAC,KAAK,OAAO;IACjB,OAAO,YAAY,QAAQ,CAAC,IAAI,IAAI,GAAG,WAAW;AACpD;AAEA,SAAS,mBAAmB,GAAuB;IACjD,IAAI,CAAC,KAAK,OAAO;IACjB,MAAM,UAAU,IAAI,IAAI;IACxB,IAAI,YAAY,QAAQ,CAAC,QAAQ,WAAW,KAAK,OAAO;IACxD,OAAO;AACT;AAEA,SAAS;IACP,OAAO,IAAA,8LAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB;AAEzC;AAEO,eAAe,KAAK,OAAgB;IACzC,MAAM,SAAS,MAAM,IAAA,uIAAU;IAE/B,IAAI,IAAA,2IAAc,EAAC,SAAS;QAC1B,OAAO,8IAAY,CAAC,IAAI,CAAC;YAAE,OAAO,OAAO,KAAK;QAAC,GAAG;YAAE,QAAQ,OAAO,MAAM;QAAC;IAC5E;IAEA,MAAM,WAAW,MAAM,IAAA,yIAAY;IACnC,MAAM,QAAQ;IACd,MAAM,OAAO,OAAO,IAAI;IACxB,MAAM,QAAQ,OAAO,UAAU,CAAC,MAAM;IAEtC,MAAM,WAAW,MAAM,QAAQ,QAAQ;IACvC,MAAM,OAAO,SAAS,GAAG,CAAC;IAC1B,MAAM,cAAc,SAAS,GAAG,CAAC;IACjC,MAAM,wBAAwB,SAAS,GAAG,CAAC;IAC3C,MAAM,aAAa,AAAC,SAAS,GAAG,CAAC,WAAsB;IAEvD,IAAI,CAAC,QAAQ,CAAC,aAAa;QACzB,OAAO,8IAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuC,GAChD;YAAE,QAAQ;QAAI;IAElB;IAEA,IAAI;IACJ,IAAI;QACF,UAAU,KAAK,KAAK,CAAC;IACvB,EAAE,OAAM;QACN,OAAO,8IAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;IAEA,qDAAqD;IACrD,IAAI,wBAAkD;IACtD,IAAI,uBAAuB;QACzB,IAAI;YACF,wBAAwB,KAAK,KAAK,CAAC;QACrC,EAAE,OAAM;QACN,+BAA+B;QACjC;IACF;IAEA,KAAK,MAAM,SAAS,gBAAiB;QACnC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;YACnB,OAAO,8IAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,CAAC,oCAAoC,EAAE,OAAO;YAAC,GACxD;gBAAE,QAAQ;YAAI;QAElB;IACF;IAEA,MAAM,oBAAoB,YAAY,IAAI,CAAC,CAAC,KAAO,CAAC,CAAC,OAAO,CAAC,GAAG;IAChE,IAAI,CAAC,mBAAmB;QACtB,OAAO,8IAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA8F,GACvG;YAAE,QAAQ;QAAI;IAElB;IAEA,MAAM,OAAO,MAAM,KAAK,IAAI;IAC5B,IAAI;IACJ,IAAI;QACF,UAAU,IAAA,oKAAK,EAAC,MAAM;YACpB,SAAS;YACT,kBAAkB;YAClB,MAAM;YACN,KAAK;QACP;IACF,EAAE,OAAO,GAAQ;QACf,OAAO,8IAAY,CAAC,IAAI,CAAC;YAAE,OAAO,CAAC,iBAAiB,EAAE,EAAE,OAAO,EAAE;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrF;IAEA,8EAA8E;IAC9E,uEAAuE;IACvE,IAAI,oBAAuC;QAAE,UAAU,CAAC;QAAG,QAAQ,CAAC;IAAE;IAEtE,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;IAEzC,IAAI,uBAAuB;QACzB,oBAAoB;IACtB,OAAO,IAAI,QAAQ;QACjB,MAAM,mBAAmB,IAAA,wIAAmB,EAAC,SAAS,QAAQ,QAAQ;QACtE,MAAM,gBAAgB,IAAA,wIAAmB,EAAC,SAAS,QAAQ,MAAM;QAEjE,IAAI,iBAAiB,MAAM,GAAG,KAAK,cAAc,MAAM,GAAG,GAAG;YAC3D,IAAI;gBACF,oBAAoB,MAAM,IAAA,6IAAwB,EAChD,kBACA,eACA;YAEJ,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,gDAAgD;YAC9D,+DAA+D;YACjE;QACF;IACF;IACA,6EAA6E;IAE7E,MAAM,EAAE,MAAM,GAAG,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,MAC1C,IAAI,CAAC,eACL,MAAM,CAAC;QACN,QAAQ;QACR,SAAS,KAAK,EAAE;QAChB,UAAU,KAAK,IAAI;QACnB,gBAAgB;QAChB,aAAa;QACb,eAAe;QACf,WAAW,QAAQ,MAAM;QACzB,QAAQ;QACR,WAAW;QACX,aAAa,eAAe,YAAY,YAAY;QACpD,gBAAgB;QAChB,oBAAoB;QACpB,YAAY,IAAI,OAAO,WAAW;IACpC,GACC,MAAM,CAAC,MACP,MAAM;IAET,IAAI,YAAY,CAAC,KAAK;QACpB,OAAO,8IAAY,CAAC,IAAI,CACtB;YAAE,OAAO,CAAC,6BAA6B,EAAE,UAAU,SAAS;QAAC,GAC7D;YAAE,QAAQ;QAAI;IAElB;IAEA,MAAM,QAAQ,IAAI,EAAE;IAEpB,IAAI,eAAe,WAAW;QAC5B,MAAM,MACH,IAAI,CAAC,eACL,MAAM,CAAC;YAAE,WAAW;QAAM,GAC1B,EAAE,CAAC,UAAU,OACb,GAAG,CAAC,MAAM;QAEb,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,MAClC,IAAI,CAAC,iBACL,MAAM,GACN,EAAE,CAAC,UAAU,OACb,EAAE,CAAC,iBAAiB;QAEvB,IAAI,aAAa;YACf,QAAQ,KAAK,CAAC,4CAA4C,YAAY,OAAO;QAC/E;QAEA,MAAM,EAAE,MAAM,SAAS,EAAE,GAAG,MAAM,MAC/B,IAAI,CAAC,eACL,MAAM,CAAC,MACP,EAAE,CAAC,UAAU,OACb,EAAE,CAAC,aAAa;QAEnB,IAAI,aAAa,UAAU,MAAM,GAAG,GAAG;YACrC,KAAK,MAAM,MAAM,UAAW;gBAC1B,MAAM,MACH,IAAI,CAAC,iBACL,MAAM,GACN,EAAE,CAAC,UAAU,OACb,EAAE,CAAC,iBAAiB,GAAG,EAAE;YAC9B;QACF;IACF;IAEA,IAAI,gBAAgB;IACpB,IAAI,eAAe;IACnB,MAAM,SAA6E,EAAE;IAErF,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,MAAM,EAAE,IAAK;QACvC,MAAM,MAAM,OAAO,CAAC,EAAE;QACtB,MAAM,SAAS,IAAI;QACnB,MAAM,YAAsB,EAAE;QAE9B,MAAM,OAAO,GAAG,CAAC,QAAQ,IAAI,CAAC,EAAE,UAAU;QAC1C,MAAM,YAAY,GAAG,CAAC,QAAQ,MAAM,CAAC,EAAE,UAAU;QACjD,MAAM,UAAU,GAAG,CAAC,QAAQ,OAAO,CAAC,EAAE,QAAQ,iBAAiB;QAC/D,MAAM,UAAU,QAAQ,IAAI,GAAG,GAAG,CAAC,QAAQ,IAAI,CAAC,EAAE,SAAS;QAC3D,MAAM,cAAc,QAAQ,QAAQ,GAAG,GAAG,CAAC,QAAQ,QAAQ,CAAC,EAAE,SAAS;QACvE,MAAM,YAAY,QAAQ,MAAM,GAAG,GAAG,CAAC,QAAQ,MAAM,CAAC,EAAE,SAAS;QACjE,MAAM,eAAe,QAAQ,UAAU,GAAG,GAAG,CAAC,QAAQ,UAAU,CAAC,EAAE,SAAS;QAC5E,MAAM,gBAAgB,QAAQ,WAAW,GAAG,GAAG,CAAC,QAAQ,WAAW,CAAC,EAAE,SAAS;QAC/E,MAAM,kBAAkB,QAAQ,sBAAsB,GAAG,GAAG,CAAC,QAAQ,sBAAsB,CAAC,EAAE,SAAS;QACvG,MAAM,aAAa,QAAQ,OAAO,GAAG,GAAG,CAAC,QAAQ,OAAO,CAAC,EAAE,SAAS;QACpE,MAAM,aAAa,QAAQ,OAAO,GAAG,GAAG,CAAC,QAAQ,OAAO,CAAC,EAAE,SAAS;QAEpE,IAAI,CAAC,MAAM,UAAU,IAAI,CAAC;QAE1B,MAAM,SAAS,WAAW;QAC1B,IAAI,CAAC,aAAa,MAAM,SAAS;YAC/B,UAAU,IAAI,CAAC;QACjB;QAEA,IAAI,CAAC,eAAe,QAAQ,CAAC,UAAU;YACrC,UAAU,IAAI,CAAC,CAAC,wBAAwB,EAAE,eAAe,IAAI,CAAC,MAAM,OAAO,EAAE,QAAQ,EAAE,CAAC;QAC1F;QAEA,IAAI;QACJ,IAAI,gBAAgB,CAAC,UAAU,eAAe;YAC5C,MAAM,IAAI,IAAI,KAAK;YACnB,IAAI,MAAM,EAAE,OAAO,KAAK;gBACtB,UAAU,IAAI,CAAC;YACjB,OAAO;gBACL,YAAY,EAAE,WAAW;YAC3B;QACF;QAEA,IAAI;QACJ,IAAI,iBAAiB,CAAC,UAAU,gBAAgB;YAC9C,MAAM,IAAI,IAAI,KAAK;YACnB,IAAI,MAAM,EAAE,OAAO,KAAK;gBACtB,UAAU,IAAI,CAAC;YACjB,OAAO;gBACL,aAAa,EAAE,WAAW;YAC5B;QACF;QAEA,IAAI;QACJ,IAAI,mBAAmB,CAAC,UAAU,kBAAkB;YAClD,MAAM,IAAI,IAAI,KAAK;YACnB,IAAI,MAAM,EAAE,OAAO,KAAK;gBACtB,UAAU,IAAI,CAAC;YACjB,OAAO;gBACL,uBAAuB,EAAE,WAAW;YACtC;QACF;QAEA,IAAI,UAAU,MAAM,GAAG,GAAG;YACxB,OAAO,IAAI,CAAC;gBACV,YAAY;gBACZ,eAAe,UAAU,IAAI,CAAC;gBAC9B,cAAc;YAChB;YACA;QACF;QAEA,MAAM,qBAAqB,mBAAmB;QAC9C,MAAM,mBAAmB,mBAAmB;QAE5C,MAAM,aAAkB;YACtB,QAAQ;YACR,eAAe;YACf,MAAM,QAAQ;YACd,MAAM,mBAAmB;YACzB,UAAU;YACV,QAAQ;YACR;YACA;YACA,SAAS,mBAAmB;YAC5B,SAAS,mBAAmB;YAC5B,kBAAkB;YAClB,kBAAkB,IAAA,yIAAoB,EAAC,oBAAoB,kBAAkB,QAAQ;YACrF,cAAc,IAAA,qIAAgB,EAAC,kBAAkB,kBAAkB,MAAM;QAC3E;QAEA,IAAI,WAAW,WAAW,UAAU,GAAG;QACvC,IAAI,YAAY,WAAW,WAAW,GAAG;QACzC,IAAI,sBAAsB,WAAW,sBAAsB,GAAG;QAE9D,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,MAClC,IAAI,CAAC,iBACL,MAAM,CAAC;QAEV,IAAI,aAAa;YACf,OAAO,IAAI,CAAC;gBACV,YAAY;gBACZ,eAAe,YAAY,OAAO;gBAClC,cAAc;YAChB;QACF,OAAO;YACL;QACF;IACF;IAEA,IAAI,OAAO,MAAM,GAAG,GAAG;QACrB,MAAM,eAAe,OAAO,GAAG,CAAC,CAAC,IAAM,CAAC;gBACtC,QAAQ;gBACR,YAAY,EAAE,UAAU;gBACxB,eAAe,EAAE,aAAa;gBAC9B,cAAc,EAAE,YAAY;YAC9B,CAAC;QACD,MAAM,MAAM,IAAI,CAAC,iBAAiB,MAAM,CAAC;IAC3C;IAEA,MAAM,cAAc,gBAAgB,IAAI,cAAc,OAAO,MAAM,GAAG,IAAI,WAAW;IAErF,MAAM,MACH,IAAI,CAAC,eACL,MAAM,CAAC;QACN,gBAAgB;QAChB,aAAa,OAAO,MAAM;QAC1B,eAAe;QACf,QAAQ;QACR,cAAc,IAAI,OAAO,WAAW;IACtC,GACC,EAAE,CAAC,MAAM;IAEZ,OAAO,8IAAY,CAAC,IAAI,CAAC;QACvB;QACA;QACA,YAAY,OAAO,MAAM;QACzB;QACA,WAAW,QAAQ,MAAM;QACzB,QAAQ,OAAO,KAAK,CAAC,GAAG;QACxB;IACF;AACF"}},
    {"offset": {"line": 761, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback, Suspense } from \"react\";\nimport { useSearchParams, useRouter } from \"next/navigation\";\nimport Link from \"next/link\";\nimport {\n  DATE_MODES,\n  PERIODS,\n  DATE_MODE_LABELS,\n  PERIOD_LABELS,\n  type DateMode,\n  type Period,\n} from \"@/lib/date-filter\";\nimport {\n  DIMENSION_KEYS,\n  DIMENSION_LABELS,\n  UNKNOWN_VALUE,\n  type DimensionKey,\n  type DimensionFilters,\n} from \"@/lib/dimension-filter\";\n\ntype Totals = {\n  count: number;\n  won: number;\n  lost: number;\n  open: number;\n  winRate: number | null;\n  avgAmountWon: number | null;\n};\n\ntype BreakdownRow = {\n  label: string;\n  count: number;\n  won: number;\n  lost: number;\n  open: number;\n  winRate: number | null;\n  avgAmountWon: number | null;\n};\n\ntype FilterMeta = {\n  dateMode: string;\n  dateModeLabel: string;\n  dateFrom: string;\n  dateTo: string;\n  periodLabel: string;\n  includedCount: number;\n  excludedNullCount: number;\n  totalOrgCount: number;\n  activeDimensionFilters: string | null;\n};\n\ntype CoverageInfo = {\n  nonNullCount: number;\n  percentage: number;\n  sufficient: boolean;\n};\n\ntype CoverageData = {\n  role: CoverageInfo;\n  industry: CoverageInfo;\n  source: CoverageInfo;\n  segment: CoverageInfo;\n  country: CoverageInfo;\n};\n\ntype SummaryData = {\n  totals: Totals;\n  byRole: BreakdownRow[];\n  byIndustry: BreakdownRow[];\n  bySource: BreakdownRow[];\n  bySegment: BreakdownRow[];\n  byCountry: BreakdownRow[];\n  coverage?: CoverageData;\n  filter: FilterMeta;\n};\n\ntype AiInsight = {\n  title: string;\n  description: string;\n  type: \"strength\" | \"risk\" | \"pattern\";\n};\n\ntype AiStageSection = {\n  headline: string;\n  insights: AiInsight[];\n};\n\ntype AiAnalysis = {\n  summary: string;\n  openPipeline: AiStageSection;\n  closedWon: AiStageSection;\n  closedLost: AiStageSection;\n  recommendations: string[];\n};\n\nfunction fmtPct(v: number | null): string {\n  if (v === null) return \"\\u2014\";\n  return `${(v * 100).toFixed(1)}%`;\n}\n\nfunction fmtCurrency(v: number | null): string {\n  if (v === null) return \"\\u2014\";\n  return new Intl.NumberFormat(\"en-US\", {\n    style: \"currency\",\n    currency: \"USD\",\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0,\n  }).format(v);\n}\n\nexport default function DashboardPage() {\n  return (\n    <Suspense fallback={\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"inline-flex items-center justify-center w-10 h-10 rounded-full bg-primary/10\">\n          <svg className=\"w-5 h-5 text-primary animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n            <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\" />\n          </svg>\n        </div>\n      </div>\n    }>\n      <DashboardContent />\n    </Suspense>\n  );\n}\n\ntype DatasetOption = {\n  id: string;\n  filename: string;\n  inserted_count: number;\n  created_at: string;\n};\n\nfunction DashboardContent() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n\n  const dateMode = (searchParams.get(\"date_mode\") as DateMode) || \"created_at\";\n  const period = (searchParams.get(\"period\") as Period) || \"30d\";\n  const customFrom = searchParams.get(\"from\") || \"\";\n  const customTo = searchParams.get(\"to\") || \"\";\n  const datasetParam = searchParams.get(\"dataset\") || \"\";\n\n  const initialDimFilters: DimensionFilters = {};\n  for (const key of DIMENSION_KEYS) {\n    const vals = searchParams.getAll(key);\n    if (vals.length > 0) initialDimFilters[key] = vals;\n  }\n\n  const [data, setData] = useState<SummaryData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n  const [aiAnalysis, setAiAnalysis] = useState<AiAnalysis | null>(null);\n  const [aiLoading, setAiLoading] = useState(false);\n  const [aiError, setAiError] = useState(\"\");\n\n  const [dimFilters, setDimFilters] = useState<DimensionFilters>(initialDimFilters);\n  const [dimOptions, setDimOptions] = useState<Record<string, string[]>>({});\n  const [filtersOpen, setFiltersOpen] = useState(() => {\n    return Object.values(initialDimFilters).some((v) => v && v.length > 0);\n  });\n  const [datasets, setDatasets] = useState<DatasetOption[]>([]);\n  const [selectedDataset, setSelectedDataset] = useState(datasetParam);\n\n  useEffect(() => {\n    async function loadDatasets() {\n      try {\n        const res = await fetch(\"/api/import/jobs\");\n        if (res.ok) {\n          const json = await res.json();\n          const activeCompleted = (json.jobs || [])\n            .filter((j: any) => j.is_active && j.status === \"completed\" && j.inserted_count > 0)\n            .map((j: any) => ({\n              id: j.id,\n              filename: j.filename,\n              inserted_count: j.inserted_count,\n              created_at: j.created_at,\n            }));\n          setDatasets(activeCompleted);\n        }\n      } catch {}\n    }\n    loadDatasets();\n  }, []);\n\n  function handleDatasetChange(newDataset: string) {\n    setSelectedDataset(newDataset);\n    const params = new URLSearchParams(searchParams.toString());\n    if (newDataset) {\n      params.set(\"dataset\", newDataset);\n    } else {\n      params.delete(\"dataset\");\n    }\n    router.replace(`?${params.toString()}`, { scroll: false });\n  }\n\n  function updateFilter(updates: Record<string, string>) {\n    const params = new URLSearchParams(searchParams.toString());\n    for (const [k, v] of Object.entries(updates)) {\n      if (v) {\n        params.set(k, v);\n      } else {\n        params.delete(k);\n      }\n    }\n    if (params.get(\"period\") !== \"custom\") {\n      params.delete(\"from\");\n      params.delete(\"to\");\n    }\n    if (selectedDataset) {\n      params.set(\"dataset\", selectedDataset);\n    }\n    for (const key of DIMENSION_KEYS) {\n      params.delete(key);\n      const vals = dimFilters[key];\n      if (vals) {\n        for (const v of vals) params.append(key, v);\n      }\n    }\n    router.replace(`?${params.toString()}`, { scroll: false });\n  }\n\n  function syncDimFiltersToUrl(newFilters: DimensionFilters) {\n    const params = new URLSearchParams(searchParams.toString());\n    for (const key of DIMENSION_KEYS) {\n      params.delete(key);\n      const vals = newFilters[key];\n      if (vals && vals.length > 0) {\n        for (const v of vals) params.append(key, v);\n      }\n    }\n    router.replace(`?${params.toString()}`, { scroll: false });\n  }\n\n  function toggleDimValue(dim: DimensionKey, value: string) {\n    setDimFilters((prev) => {\n      const current = prev[dim] || [];\n      const next = current.includes(value)\n        ? current.filter((v) => v !== value)\n        : [...current, value];\n      const updated = { ...prev, [dim]: next.length > 0 ? next : undefined };\n      if (next.length === 0) delete updated[dim];\n      syncDimFiltersToUrl(updated);\n      return updated;\n    });\n  }\n\n  function clearAllDimFilters() {\n    setDimFilters({});\n    const params = new URLSearchParams(searchParams.toString());\n    for (const key of DIMENSION_KEYS) params.delete(key);\n    router.replace(`?${params.toString()}`, { scroll: false });\n  }\n\n  const activeDimFilterCount = Object.values(dimFilters).reduce(\n    (sum, vals) => sum + (vals?.length || 0),\n    0\n  );\n\n  const fetchDimensions = useCallback(async () => {\n    try {\n      const params = new URLSearchParams();\n      params.set(\"date_mode\", dateMode);\n      params.set(\"period\", period);\n      if (period === \"custom\") {\n        if (customFrom) params.set(\"from\", customFrom);\n        if (customTo) params.set(\"to\", customTo);\n      }\n      if (selectedDataset) params.set(\"dataset\", selectedDataset);\n      const res = await fetch(`/api/analytics/dimensions?${params.toString()}`);\n      if (res.ok) {\n        const json = await res.json();\n        setDimOptions(json.dimensions || {});\n      }\n    } catch {}\n  }, [dateMode, period, customFrom, customTo, selectedDataset]);\n\n  const fetchData = useCallback(async () => {\n    setLoading(true);\n    setError(\"\");\n    try {\n      const params = new URLSearchParams();\n      params.set(\"date_mode\", dateMode);\n      params.set(\"period\", period);\n      if (period === \"custom\") {\n        if (customFrom) params.set(\"from\", customFrom);\n        if (customTo) params.set(\"to\", customTo);\n      }\n      if (selectedDataset) params.set(\"dataset\", selectedDataset);\n      for (const key of DIMENSION_KEYS) {\n        const vals = dimFilters[key];\n        if (vals && vals.length > 0) {\n          for (const v of vals) params.append(key, v);\n        }\n      }\n      const res = await fetch(`/api/analytics/summary?${params.toString()}`);\n      if (!res.ok) {\n        const body = await res.json().catch(() => ({}));\n        setError(body.error || \"Failed to load analytics\");\n        return;\n      }\n      setData(await res.json());\n    } catch {\n      setError(\"Failed to load analytics\");\n    } finally {\n      setLoading(false);\n    }\n  }, [dateMode, period, customFrom, customTo, dimFilters, selectedDataset]);\n\n  useEffect(() => {\n    fetchDimensions();\n  }, [fetchDimensions]);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  async function runAiAnalysis() {\n    setAiLoading(true);\n    setAiError(\"\");\n    setAiAnalysis(null);\n    try {\n      const body: Record<string, any> = {\n        date_mode: dateMode,\n        period: period,\n      };\n      if (period === \"custom\") {\n        if (customFrom) body.from = customFrom;\n        if (customTo) body.to = customTo;\n      }\n      if (selectedDataset) body.dataset = selectedDataset;\n      for (const key of DIMENSION_KEYS) {\n        const vals = dimFilters[key];\n        if (vals && vals.length > 0) {\n          body[key] = vals;\n        }\n      }\n      const res = await fetch(\"/api/ai/analyze\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(body),\n      });\n      if (!res.ok) {\n        const json = await res.json().catch(() => ({}));\n        setAiError(json.error || \"AI analysis failed\");\n        return;\n      }\n      const json = await res.json();\n      setAiAnalysis(json.analysis);\n    } catch {\n      setAiError(\"AI analysis failed. Please try again.\");\n    } finally {\n      setAiLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"border-b border-border\">\n        <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between gap-4 flex-wrap\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"inline-flex items-center justify-center w-8 h-8 rounded-md bg-primary\">\n              <svg className=\"w-4 h-4 text-primary-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n              </svg>\n            </div>\n            <span className=\"text-sm font-semibold text-foreground\" data-testid=\"text-dashboard-title\">\n              Analytics Dashboard\n            </span>\n          </div>\n          <div className=\"flex items-center gap-3 flex-wrap\">\n            <Link\n              href=\"/app/import\"\n              className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n              data-testid=\"link-import\"\n            >\n              Import\n            </Link>\n            <Link\n              href=\"/app\"\n              className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n              data-testid=\"link-home\"\n            >\n              Home\n            </Link>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10\">\n        {/* Filter Bar */}\n        <div className=\"rounded-md border border-border bg-card p-4 mb-4\" data-testid=\"filter-bar\">\n          <div className=\"flex flex-wrap items-end gap-4\">\n            {datasets.length > 0 && (\n              <div className=\"flex flex-col gap-1.5\">\n                <label className=\"text-xs font-medium text-muted-foreground\" htmlFor=\"dataset-select\">\n                  Dataset\n                </label>\n                <select\n                  id=\"dataset-select\"\n                  value={selectedDataset}\n                  onChange={(e) => handleDatasetChange(e.target.value)}\n                  className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/30\"\n                  data-testid=\"select-dataset\"\n                >\n                  <option value=\"\">All Data</option>\n                  {datasets.map((ds) => (\n                    <option key={ds.id} value={ds.id}>\n                      {ds.filename} ({ds.inserted_count} rows)\n                    </option>\n                  ))}\n                </select>\n              </div>\n            )}\n\n            <div className=\"flex flex-col gap-1.5\">\n              <label className=\"text-xs font-medium text-muted-foreground\" htmlFor=\"date-mode\">\n                Date Mode\n              </label>\n              <select\n                id=\"date-mode\"\n                value={dateMode}\n                onChange={(e) => updateFilter({ date_mode: e.target.value })}\n                className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/30\"\n                data-testid=\"select-date-mode\"\n              >\n                {DATE_MODES.map((m) => (\n                  <option key={m} value={m}>\n                    {DATE_MODE_LABELS[m]}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div className=\"flex flex-col gap-1.5\">\n              <label className=\"text-xs font-medium text-muted-foreground\" htmlFor=\"period\">\n                Time Period\n              </label>\n              <select\n                id=\"period\"\n                value={period}\n                onChange={(e) => updateFilter({ period: e.target.value })}\n                className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/30\"\n                data-testid=\"select-period\"\n              >\n                {PERIODS.map((p) => (\n                  <option key={p} value={p}>\n                    {PERIOD_LABELS[p]}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            {period === \"custom\" && (\n              <>\n                <div className=\"flex flex-col gap-1.5\">\n                  <label className=\"text-xs font-medium text-muted-foreground\" htmlFor=\"custom-from\">\n                    From\n                  </label>\n                  <input\n                    type=\"date\"\n                    id=\"custom-from\"\n                    value={customFrom}\n                    onChange={(e) => updateFilter({ from: e.target.value })}\n                    className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/30\"\n                    data-testid=\"input-date-from\"\n                  />\n                </div>\n                <div className=\"flex flex-col gap-1.5\">\n                  <label className=\"text-xs font-medium text-muted-foreground\" htmlFor=\"custom-to\">\n                    To\n                  </label>\n                  <input\n                    type=\"date\"\n                    id=\"custom-to\"\n                    value={customTo}\n                    onChange={(e) => updateFilter({ to: e.target.value })}\n                    className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/30\"\n                    data-testid=\"input-date-to\"\n                  />\n                </div>\n              </>\n            )}\n\n            <button\n              onClick={() => setFiltersOpen((v) => !v)}\n              className={`inline-flex items-center gap-1.5 rounded-md border px-3 py-2 text-sm font-medium transition-colors ${\n                activeDimFilterCount > 0\n                  ? \"border-primary bg-primary/10 text-primary\"\n                  : \"border-border bg-background text-foreground\"\n              }`}\n              data-testid=\"button-toggle-filters\"\n            >\n              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z\" />\n              </svg>\n              Filters\n              {activeDimFilterCount > 0 && (\n                <span className=\"inline-flex items-center justify-center min-w-[18px] h-[18px] rounded-full bg-primary text-primary-foreground text-[10px] font-semibold px-1\">\n                  {activeDimFilterCount}\n                </span>\n              )}\n              <svg className={`w-3 h-3 transition-transform ${filtersOpen ? \"rotate-180\" : \"\"}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n              </svg>\n            </button>\n          </div>\n\n          {data?.filter && (\n            <div className=\"mt-3 flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-muted-foreground\" data-testid=\"filter-meta\">\n              <span>\n                Showing <strong className=\"text-foreground\">{data.filter.includedCount}</strong> opportunities\n              </span>\n              <span>\n                {data.filter.dateModeLabel}: {new Date(data.filter.dateFrom).toLocaleDateString()} &ndash; {new Date(data.filter.dateTo).toLocaleDateString()}\n              </span>\n              {data.filter.excludedNullCount > 0 && (\n                <span>\n                  ({data.filter.excludedNullCount} excluded &mdash; missing {data.filter.dateModeLabel.toLowerCase()})\n                </span>\n              )}\n              {selectedDataset && datasets.length > 0 && (\n                <span data-testid=\"text-active-dataset\">\n                  Dataset: {datasets.find((d) => d.id === selectedDataset)?.filename || \"Selected\"}\n                </span>\n              )}\n              {data.filter.activeDimensionFilters && (\n                <span data-testid=\"text-active-dim-filters\">\n                  Filtered by: {data.filter.activeDimensionFilters}\n                </span>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Dimension Filters Panel */}\n        {filtersOpen && (\n          <div className=\"rounded-md border border-border bg-card p-4 mb-8\" data-testid=\"dimension-filters-panel\">\n            <div className=\"flex items-center justify-between gap-4 flex-wrap mb-3\">\n              <h3 className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n                Dimension Filters\n              </h3>\n              {activeDimFilterCount > 0 && (\n                <button\n                  onClick={clearAllDimFilters}\n                  className=\"text-xs text-primary hover:underline\"\n                  data-testid=\"button-clear-all-filters\"\n                >\n                  Clear all\n                </button>\n              )}\n            </div>\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5\">\n              {DIMENSION_KEYS.map((dim) => {\n                const options = dimOptions[dim] || [];\n                const selected = dimFilters[dim] || [];\n                return (\n                  <div key={dim} data-testid={`dim-filter-${dim}`}>\n                    <p className=\"text-xs font-medium text-foreground mb-2\">{DIMENSION_LABELS[dim]}</p>\n                    {options.length === 0 ? (\n                      <p className=\"text-xs text-muted-foreground\">No values</p>\n                    ) : (\n                      <div className=\"space-y-1 max-h-40 overflow-y-auto pr-1\">\n                        {options.map((val) => {\n                          const isChecked = selected.includes(val);\n                          return (\n                            <label\n                              key={val}\n                              className=\"flex items-center gap-2 cursor-pointer text-xs text-foreground hover:bg-muted/40 rounded px-1 py-0.5\"\n                              data-testid={`dim-option-${dim}-${val}`}\n                            >\n                              <input\n                                type=\"checkbox\"\n                                checked={isChecked}\n                                onChange={() => toggleDimValue(dim, val)}\n                                className=\"rounded border-border text-primary focus:ring-primary/30 h-3.5 w-3.5\"\n                              />\n                              <span className={val === UNKNOWN_VALUE ? \"italic text-muted-foreground\" : \"\"}>\n                                {val}\n                              </span>\n                            </label>\n                          );\n                        })}\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        )}\n\n        {!filtersOpen && <div className=\"mb-8\" />}\n\n        {loading && (\n          <div className=\"flex items-center justify-center py-20\" data-testid=\"loading-state\">\n            <div className=\"inline-flex items-center justify-center w-10 h-10 rounded-full bg-primary/10\">\n              <svg className=\"w-5 h-5 text-primary animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\n                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\" />\n              </svg>\n            </div>\n          </div>\n        )}\n\n        {error && (\n          <div className=\"rounded-md border border-red-300 bg-red-50 dark:bg-red-950/20 dark:border-red-800 px-4 py-3 text-sm text-red-700 dark:text-red-400\" data-testid=\"text-error\">\n            {error}\n          </div>\n        )}\n\n        {!loading && !error && data && data.totals.count === 0 && (\n          <div className=\"text-center py-20\" data-testid=\"empty-state\">\n            <div className=\"inline-flex items-center justify-center w-14 h-14 rounded-full bg-muted mb-4\">\n              <svg className=\"w-7 h-7 text-muted-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n              </svg>\n            </div>\n            <h2 className=\"text-lg font-semibold text-foreground mb-1\">No opportunities found</h2>\n            <p className=\"text-sm text-muted-foreground mb-6 max-w-md mx-auto\">\n              No data matches the selected filters. Try adjusting the date mode, time period, or dimension filters, or import opportunities from CSV.\n            </p>\n            <Link\n              href=\"/app/import\"\n              className=\"inline-flex items-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground\"\n              data-testid=\"link-import-cta\"\n            >\n              <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\" />\n              </svg>\n              Import Opportunities\n            </Link>\n          </div>\n        )}\n\n        {!loading && !error && data && data.totals.count > 0 && (\n          <div className=\"space-y-8\">\n            <div>\n              <h1 className=\"text-2xl font-semibold tracking-tight text-foreground\">\n                Analytics\n              </h1>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Performance overview of your opportunities pipeline.\n              </p>\n            </div>\n\n            {/* KPI Cards */}\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\" data-testid=\"kpi-cards\">\n              <KpiCard\n                label=\"Total Opportunities\"\n                value={String(data.totals.count)}\n                sub={`${data.totals.open} open \\u00B7 ${data.totals.won} won \\u00B7 ${data.totals.lost} lost`}\n                testId=\"kpi-total\"\n              />\n              <KpiCard\n                label=\"Win Rate\"\n                value={fmtPct(data.totals.winRate)}\n                sub={data.totals.winRate !== null ? `${data.totals.won} won of ${data.totals.won + data.totals.lost} decided` : \"No decided deals yet\"}\n                testId=\"kpi-winrate\"\n              />\n              <KpiCard\n                label=\"Avg Amount (Won)\"\n                value={fmtCurrency(data.totals.avgAmountWon)}\n                sub={data.totals.avgAmountWon !== null ? `From ${data.totals.won} won deals` : \"No won deals yet\"}\n                testId=\"kpi-avgamount\"\n              />\n              <KpiCard\n                label=\"Open Pipeline\"\n                value={String(data.totals.open)}\n                sub=\"Opportunities in progress\"\n                testId=\"kpi-open\"\n              />\n            </div>\n\n            {/* Breakdown Tables */}\n            {(() => {\n              const c = data.coverage;\n              const breakdowns = [\n                { title: \"By Champion Role\", rows: data.byRole, testId: \"breakdown-role\", dim: \"role\" as const, label: \"champion role\" },\n                { title: \"By Industry\", rows: data.byIndustry, testId: \"breakdown-industry\", dim: \"industry\" as const, label: \"industry\" },\n                { title: \"By Source\", rows: data.bySource, testId: \"breakdown-source\", dim: \"source\" as const, label: \"source\" },\n                { title: \"By Segment\", rows: data.bySegment, testId: \"breakdown-segment\", dim: \"segment\" as const, label: \"segment\" },\n                { title: \"By Country\", rows: data.byCountry, testId: \"breakdown-country\", dim: \"country\" as const, label: \"country\" },\n              ];\n              const visible = breakdowns.filter((b) => !c || c[b.dim]?.sufficient !== false);\n              const hidden = breakdowns.filter((b) => c && c[b.dim]?.sufficient === false);\n              const topRow = visible.slice(0, 3);\n              const bottomRow = visible.slice(3);\n              return (\n                <>\n                  {topRow.length > 0 && (\n                    <div className={`grid gap-6 ${topRow.length === 1 ? \"\" : topRow.length === 2 ? \"lg:grid-cols-2\" : \"lg:grid-cols-3\"}`}>\n                      {topRow.map((b) => (\n                        <BreakdownTable key={b.testId} title={b.title} rows={b.rows} testId={b.testId} />\n                      ))}\n                    </div>\n                  )}\n                  {bottomRow.length > 0 && (\n                    <div className={`grid gap-6 ${bottomRow.length === 1 ? \"\" : \"lg:grid-cols-2\"}`}>\n                      {bottomRow.map((b) => (\n                        <BreakdownTable key={b.testId} title={b.title} rows={b.rows} testId={b.testId} />\n                      ))}\n                    </div>\n                  )}\n                  {hidden.length > 0 && (\n                    <div className=\"rounded-md border border-border bg-muted/30 p-4\" data-testid=\"hidden-breakdowns-note\">\n                      <p className=\"text-xs text-muted-foreground\">\n                        {hidden.map((b) => b.title).join(\", \")} breakdown{hidden.length > 1 ? \"s\" : \"\"} hidden:{\" \"}\n                        {hidden.map((b) => `${b.label} not provided in this dataset`).join(\"; \")}.\n                      </p>\n                    </div>\n                  )}\n                </>\n              );\n            })()}\n\n            {/* AI Analysis Section */}\n            <div className=\"rounded-md border border-border bg-card p-6\" data-testid=\"ai-analysis-section\">\n              <div className=\"flex items-center justify-between gap-4 flex-wrap mb-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"inline-flex items-center justify-center w-8 h-8 rounded-md bg-primary/10\">\n                    <svg className=\"w-4 h-4 text-primary\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\" />\n                    </svg>\n                  </div>\n                  <div>\n                    <h3 className=\"text-sm font-medium text-foreground\">AI-Powered Analysis</h3>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Analyzing with {DATE_MODE_LABELS[dateMode]} &middot; {PERIOD_LABELS[period]}\n                      {activeDimFilterCount > 0 && ` \\u00B7 ${activeDimFilterCount} filter${activeDimFilterCount > 1 ? \"s\" : \"\"} active`}\n                    </p>\n                  </div>\n                </div>\n                <button\n                  onClick={runAiAnalysis}\n                  disabled={aiLoading}\n                  className=\"inline-flex items-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                  data-testid=\"button-ai-analyze\"\n                >\n                  {aiLoading ? (\n                    <>\n                      <svg className=\"w-4 h-4 mr-2 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\n                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\" />\n                      </svg>\n                      Analyzing...\n                    </>\n                  ) : (\n                    <>\n                      <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                      </svg>\n                      Analyze with AI\n                    </>\n                  )}\n                </button>\n              </div>\n\n              {aiError && (\n                <div className=\"rounded-md border border-red-300 bg-red-50 dark:bg-red-950/20 dark:border-red-800 px-4 py-3 text-sm text-red-700 dark:text-red-400 mb-4\" data-testid=\"text-ai-error\">\n                  {aiError}\n                </div>\n              )}\n\n              {!aiAnalysis && !aiLoading && !aiError && (\n                <p className=\"text-sm text-muted-foreground\" data-testid=\"text-ai-placeholder\">\n                  Click the button above to generate AI-powered insights for the current filters.\n                </p>\n              )}\n\n              {aiAnalysis && (\n                <div className=\"space-y-6\" data-testid=\"ai-results\">\n                  {/* Summary */}\n                  <div data-testid=\"ai-summary\">\n                    <p className=\"text-sm text-foreground leading-relaxed\">{aiAnalysis.summary}</p>\n                  </div>\n\n                  {/* Stage Sections */}\n                  <div className=\"space-y-5\">\n                    <AiStageCard\n                      title=\"Open Pipeline\"\n                      section={aiAnalysis.openPipeline}\n                      accentColor=\"blue\"\n                      icon={\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                        </svg>\n                      }\n                      testId=\"ai-stage-open\"\n                    />\n                    <AiStageCard\n                      title=\"Closed Won\"\n                      section={aiAnalysis.closedWon}\n                      accentColor=\"green\"\n                      icon={\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                        </svg>\n                      }\n                      testId=\"ai-stage-won\"\n                    />\n                    <AiStageCard\n                      title=\"Closed Lost\"\n                      section={aiAnalysis.closedLost}\n                      accentColor=\"red\"\n                      icon={\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                        </svg>\n                      }\n                      testId=\"ai-stage-lost\"\n                    />\n                  </div>\n\n                  {/* Recommendations */}\n                  <div data-testid=\"ai-recommendations\">\n                    <h4 className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide mb-3\">Recommendations</h4>\n                    <div className=\"space-y-2\">\n                      {aiAnalysis.recommendations.map((rec, i) => (\n                        <div\n                          key={i}\n                          className=\"flex items-start gap-3 rounded-md border border-border bg-muted/20 px-4 py-3\"\n                          data-testid={`ai-rec-${i}`}\n                        >\n                          <span className=\"inline-flex items-center justify-center min-w-[24px] h-6 rounded-full bg-primary text-primary-foreground text-xs font-semibold\">\n                            {i + 1}\n                          </span>\n                          <p className=\"text-sm text-foreground leading-relaxed\">{rec}</p>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}\n\n/* ─── Stage Section Card ─── */\n\nconst ACCENT_STYLES = {\n  blue: {\n    header: \"border-blue-200 bg-blue-50 dark:bg-blue-950/20 dark:border-blue-900\",\n    iconBg: \"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400\",\n    title: \"text-blue-900 dark:text-blue-200\",\n    headline: \"text-blue-800 dark:text-blue-300\",\n  },\n  green: {\n    header: \"border-green-200 bg-green-50 dark:bg-green-950/20 dark:border-green-900\",\n    iconBg: \"bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400\",\n    title: \"text-green-900 dark:text-green-200\",\n    headline: \"text-green-800 dark:text-green-300\",\n  },\n  red: {\n    header: \"border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-900\",\n    iconBg: \"bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-400\",\n    title: \"text-red-900 dark:text-red-200\",\n    headline: \"text-red-800 dark:text-red-300\",\n  },\n};\n\nconst INSIGHT_TYPE_STYLES: Record<string, { border: string; label: string; labelColor: string }> = {\n  strength: {\n    border: \"border-l-green-500\",\n    label: \"STRENGTH\",\n    labelColor: \"text-green-600 dark:text-green-400\",\n  },\n  risk: {\n    border: \"border-l-red-500\",\n    label: \"RISK\",\n    labelColor: \"text-red-600 dark:text-red-400\",\n  },\n  pattern: {\n    border: \"border-l-blue-500\",\n    label: \"PATTERN\",\n    labelColor: \"text-blue-600 dark:text-blue-400\",\n  },\n};\n\nfunction AiStageCard({\n  title,\n  section,\n  accentColor,\n  icon,\n  testId,\n}: {\n  title: string;\n  section: AiStageSection;\n  accentColor: \"blue\" | \"green\" | \"red\";\n  icon: React.ReactNode;\n  testId: string;\n}) {\n  const styles = ACCENT_STYLES[accentColor];\n\n  return (\n    <div className=\"rounded-md border border-border overflow-hidden\" data-testid={testId}>\n      {/* Section Header */}\n      <div className={`px-4 py-3 border-b ${styles.header}`}>\n        <div className=\"flex items-center gap-2 mb-1\">\n          <div className={`inline-flex items-center justify-center w-6 h-6 rounded-md ${styles.iconBg}`}>\n            {icon}\n          </div>\n          <h4 className={`text-sm font-semibold ${styles.title}`}>{title}</h4>\n        </div>\n        <p className={`text-xs leading-relaxed ${styles.headline}`}>{section.headline}</p>\n      </div>\n\n      {/* Insights */}\n      {section.insights.length > 0 ? (\n        <div className=\"divide-y divide-border/50\">\n          {section.insights.map((insight, i) => {\n            const typeStyle = INSIGHT_TYPE_STYLES[insight.type] || INSIGHT_TYPE_STYLES.pattern;\n            return (\n              <div\n                key={i}\n                className={`px-4 py-3 border-l-[3px] ${typeStyle.border}`}\n                data-testid={`${testId}-insight-${i}`}\n              >\n                <div className=\"flex items-center gap-2 mb-0.5\">\n                  <span className={`text-[10px] font-semibold tracking-wide ${typeStyle.labelColor}`}>\n                    {typeStyle.label}\n                  </span>\n                </div>\n                <p className=\"text-xs font-medium text-foreground\">{insight.title}</p>\n                <p className=\"text-xs text-muted-foreground leading-relaxed mt-0.5\">{insight.description}</p>\n              </div>\n            );\n          })}\n        </div>\n      ) : (\n        <div className=\"px-4 py-3\">\n          <p className=\"text-xs text-muted-foreground\">No deals in this stage for the selected filters.</p>\n        </div>\n      )}\n    </div>\n  );\n}\n\n/* ─── Shared Components ─── */\n\nfunction KpiCard({ label, value, sub, testId }: { label: string; value: string; sub: string; testId: string }) {\n  return (\n    <div className=\"rounded-md border border-border bg-card p-5\" data-testid={testId}>\n      <p className=\"text-xs font-medium text-muted-foreground\">{label}</p>\n      <p className=\"text-2xl font-semibold text-foreground mt-1\">{value}</p>\n      <p className=\"text-xs text-muted-foreground mt-1\">{sub}</p>\n    </div>\n  );\n}\n\nfunction BreakdownTable({ title, rows, testId }: { title: string; rows: BreakdownRow[]; testId: string }) {\n  return (\n    <div className=\"rounded-md border border-border bg-card p-5\" data-testid={testId}>\n      <h3 className=\"text-sm font-medium text-foreground mb-3\">{title}</h3>\n      {rows.length === 0 ? (\n        <p className=\"text-xs text-muted-foreground\">No data</p>\n      ) : (\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full text-xs\">\n            <thead>\n              <tr className=\"border-b border-border\">\n                <th className=\"text-left py-2 pr-3 font-medium text-muted-foreground\">{title.replace(\"By \", \"\")}</th>\n                <th className=\"text-right py-2 px-2 font-medium text-muted-foreground\">Count</th>\n                <th className=\"text-right py-2 px-2 font-medium text-muted-foreground\">Win Rate</th>\n                <th className=\"text-right py-2 pl-2 font-medium text-muted-foreground\">Avg Amt</th>\n              </tr>\n            </thead>\n            <tbody>\n              {rows.map((row) => (\n                <tr key={row.label} className=\"border-b border-border/50\">\n                  <td className={`py-2 pr-3 font-medium whitespace-nowrap ${row.label === UNKNOWN_VALUE ? \"text-muted-foreground italic\" : \"text-foreground\"}`}>\n                    {row.label}\n                  </td>\n                  <td className=\"py-2 px-2 text-right text-foreground\">{row.count}</td>\n                  <td className=\"py-2 px-2 text-right text-foreground\">{fmtPct(row.winRate)}</td>\n                  <td className=\"py-2 pl-2 text-right text-foreground\">{fmtCurrency(row.avgAmountWon)}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}